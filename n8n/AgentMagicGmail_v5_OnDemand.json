{
  "nodes": [
    {
      "parameters": {
        "operation": "removeLabels",
        "messageId": "={{ $json.id }}",
        "labelIds": [
          "Label_8388846993740763261"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [
        160,
        -112
      ],
      "id": "775fd7b2-f905-4865-aece-b8cd03ee0a60",
      "name": "Usu≈Ñ Etykietƒô (Start)",
      "webhookId": "e039fa09-37c4-4f0c-a4a5-41bc4bb99aa0",
      "credentials": {
        "gmailOAuth2": {
          "id": "UkJS0m5NScuFyhnL",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "resource": "chat",
        "model": "gpt-4o",
        "prompt": {
          "messages": [
            {
              "role": "system",
              "content": "# System Prompt: Agent DraftujƒÖcy\n\n## Rola\nJeste≈õ MartƒÖ ‚Äì asertywnym, konkretnym i dyplomatycznym Senior Account Managerem w agencji marketingowej.\nTwoim celem jest ochrona rentowno≈õci, czasu zespo≈Çu i procesu, przy jednoczesnym utrzymaniu partnerskich relacji z klientem.\n\n## Filozofia Stylu (\"Asertywna W≈Ça≈õcicielka\")\n1. **BƒÑD≈π ZWIƒòZ≈ÅA:** Unikaj lania wody. Ka≈ºde zdanie ma cel.\n2. **JƒòZYK:** Prosty, ludzki, bez korpo-slangu.\n   - ‚õî ≈πLE: \"dowie≈∫ƒá\" (w ka≈ºdym kontek≈õcie - absolutny zakaz), \"dowie≈∫ƒá temat\", \"dowoziƒá wyniki\", \"jeste≈õmy w deep work\", \"ASAP\", \"estymujƒô\", \"na cito\".\n   - ‚úÖ DOBRZE: \"zrobiƒá\", \"wykonaƒá\", \"kampania dzia≈Ça/pracuje\" (zamiast \"dowozi\"), \"siedzƒô nad projektem\", \"pilne\", \"szacujƒô\", \"szybko\".\n3. **PARTNERSTWO:** U≈ºywaj formy \"My\" (gramy do jednej bramki), ale stawiaj granice.\n4. **FORMATOWANIE (HTML):**\n   - U≈ºywaj `<br><br>` do oddzielania akapit√≥w.\n   - U≈ºywaj `<b>` do pogrubienia kluczowych fakt√≥w lub opcji.\n   - U≈ºywaj list `<ul><li>`, je≈õli wymieniasz opcje.\n5. **WIERNO≈öƒÜ KONTEKSTOWI (CRITICAL):**\n   - Opieraj siƒô **WY≈ÅƒÑCZNIE** na faktach z wiadomo≈õci klienta.\n   - ‚õî **NIE WYMY≈öLAJ** kana≈Ç√≥w (np. nie pisz o TikToku/FB, je≈õli klient pyta o stronƒô WWW).\n   - ‚õî **NIE HALUCYNUJ** format√≥w (je≈õli klient przesy≈Ça wideo na stronƒô, nie traktuj tego jako reklamy w social media).\n   - Je≈õli nie masz pewno≈õci co do kontekstu -> zadaj pytanie doprecyzujƒÖce w tre≈õci maila.\n\n## Zadanie\nPrzeanalizuj wiadomo≈õƒá od klienta i przygotuj draft odpowiedzi w zale≈ºno≈õci od typu problemu:\n\n### SCENARIUSZ A: SCOPE CREEP (Pro≈õba o darmowƒÖ pracƒô/co≈õ \"przy okazji\")\nAlgorytm:\n1. **Cushion:** Podziƒôkuj, doce≈Ñ.\n2. **Anchor:** Przypomnij o priorytecie obecnego zlecenia (SOW).\n3. **Impact:** Wyja≈õnij kr√≥tko, ≈ºe \"ma≈Ça zmiana\" to koszt (oderwanie zespo≈Çu, pliki, QA).\n4. **Options (Opcje):** Przedstaw 3 drogi w formie naturalnej listy (bez etykiet \"Opcja A\"):\n   - Zrobimy to jako dodatkowe zlecenie (p≈Çatne).\n   - Zrobimy to *zamiast* innego zadania (wymiana).\n   - Wr√≥cimy do tematu w przysz≈Çym miesiƒÖcu (backlog).\n5. **CTA:** Pro≈õba o decyzjƒô.\n\n### SCENARIUSZ B: PANIKA / AWARIA (Klient krzyczy/boi siƒô)\nAlgorytm:\n1. **Spok√≥j:** Podziƒôkuj za sygna≈Ç, nie przepraszaj bez powodu.\n2. **Fakty:** Napisz, co widaƒá w danych (zga≈õ emocje faktami).\n3. **Plan:** Napisz, co robisz (np. diagnoza w 30 min).\n4. **Bezpiecze≈Ñstwo:** Zapewnij, ≈ºe bud≈ºet/dane sƒÖ bezpieczne.\n\n### SCENARIUSZ C: NEGOCJACJE / RABATY\nAlgorytm:\n1. **Zrozumienie:** Rozumiem sytuacjƒô rynkowƒÖ.\n2. **Obrona Warto≈õci:** Cena wynika z jako≈õci senior√≥w. Nie mo≈ºemy zej≈õƒá z ceny bez utraty jako≈õci.\n3. **Alternatywa:** Raty lub mniejszy zakres.\n\n### SCENARIUSZ D: SUBIEKTYWNE ODCZUCIA (\"Nie czujƒô tego\" / \"Brak pazura\")\nAlgorytm:\n1. **Otwarto≈õƒá:** Podziƒôkuj za szczery feedback.\n2. **Analiza:** Nie zgaduj. Popro≈õ o konkrety.\n3. **Benchmark:** Popro≈õ o 1-2 przyk≈Çady tekst√≥w/grafik konkurencji, kt√≥re majƒÖ ten \"pazur\".\n4. **Plan:** Obiecaj rewizjƒô po otrzymaniu inspiracji.\n\n---\n\n## Format Wyj≈õciowy\nWygeneruj TYLKO tre≈õƒá wiadomo≈õci w formacie HTML (gotowƒÖ do wklejenia w body maila). Nie dodawaj tematu. Nie dodawaj ```html```.\n\n[Tre≈õƒá wiadomo≈õci z tagami HTML]\n\nPozdrawiam,<br>\nMarta"
            },
            {
              "content": "==Oto mail od klienta:\nOd: {{ $('Get many messages').item.json.From }}\nTemat: {{ $('Get many messages').item.json.Subject }}\nTre≈õƒá:\n{{ $('Get many messages').item.json.snippet }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        368,
        -112
      ],
      "id": "1d3a5b69-e47d-406e-b8e6-266f5565a060",
      "name": "AI Pisarz (Marta)",
      "credentials": {
        "openAiApi": {
          "id": "7AzOZOpey5mYnsPi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "draft",
        "subject": "={{ $('Get many messages').item.json.Subject }}",
        "emailType": "html",
        "message": "={{ $json.message.content }}",
        "options": {
          "threadId": "={{ $('Get many messages').item.json.threadId }}",
          "sendTo": "={{ $('Get many messages').item.json.From }}"
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [
        608,
        -112
      ],
      "id": "cee6f6f3-9412-4dd4-b99b-ff7f5eef379d",
      "name": "Create Draft",
      "webhookId": "ebaa8ffe-c471-4670-bb1c-c118b849a238",
      "credentials": {
        "gmailOAuth2": {
          "id": "UkJS0m5NScuFyhnL",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $json.message.threadId }}",
        "labelIds": [
          "Label_8698956675052924918"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [
        816,
        -112
      ],
      "id": "9eecec53-7612-4aed-9a7d-f2aabcb83505",
      "name": "Oznacz jako Gotowe",
      "webhookId": "a2ec31a7-3ad4-48b8-8ca6-55847c440fcf",
      "credentials": {
        "gmailOAuth2": {
          "id": "UkJS0m5NScuFyhnL",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0A1HQ6UV5G",
          "mode": "list",
          "cachedResultName": "general"
        },
        "text": "=üîî *Nowy Draft!* \n\n*Od:* {{ $('Get many messages').item.json.From }}\n*Temat:* {{ $('Get many messages').item.json.Subject }}\n\n>>> Sprawd≈∫ etykietƒô Draft Gotowe w Gmailu.\n\nhttps://mail.google.com/mail/u/0/#drafts/{{ $('Create Draft').item.json.message.id }}",
        "otherOptions": {
          "mrkdwn": true
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1040,
        -112
      ],
      "id": "c94e21b8-babd-484f-9102-512b34573627",
      "name": "Powiadomienie Slack",
      "webhookId": "32825734-310d-4c43-8bdb-2d27238cb9fd",
      "credentials": {
        "slackApi": {
          "id": "NPzsVJ02vnm3zhgA",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "trigger": [
          "message"
        ],
        "channelId": {
          "__rl": true,
          "value": "C0A1HQ6UV5G",
          "mode": "list",
          "cachedResultName": "general"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.slackTrigger",
      "typeVersion": 1,
      "position": [
        -592,
        -112
      ],
      "id": "c5b0e665-12eb-4be7-b940-acb10287307d",
      "name": "Slack Trigger",
      "webhookId": "be27ff63-5dd2-4ea7-8edd-f3ee1c5319e9",
      "credentials": {
        "slackApi": {
          "id": "NPzsVJ02vnm3zhgA",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "74b5a06c-e92d-400b-a654-192aa19cdd96",
              "leftValue": "={{ $json.text }}",
              "rightValue": "draftuj",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -368,
        -112
      ],
      "id": "3751aca6-da72-4609-bc4d-95a91cef0519",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "getAll",
        "limit": 10,
        "filters": {
          "labelIds": [
            "Label_8388846993740763261"
          ]
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -96,
        -160
      ],
      "id": "cff3d471-9838-4977-9563-4c23c488b7eb",
      "name": "Get many messages",
      "webhookId": "673a0b1c-d478-470c-a3f6-059d37aa2494",
      "credentials": {
        "gmailOAuth2": {
          "id": "UkJS0m5NScuFyhnL",
          "name": "Gmail account"
        }
      }
    }
  ],
  "connections": {
    "Usu≈Ñ Etykietƒô (Start)": {
      "main": [
        [
          {
            "node": "AI Pisarz (Marta)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Pisarz (Marta)": {
      "main": [
        [
          {
            "node": "Create Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Draft": {
      "main": [
        [
          {
            "node": "Oznacz jako Gotowe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oznacz jako Gotowe": {
      "main": [
        [
          {
            "node": "Powiadomienie Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Slack Trigger": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Get many messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many messages": {
      "main": [
        [
          {
            "node": "Usu≈Ñ Etykietƒô (Start)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "78243e79453de537183305a3c3825e24de7eb0bc8972ce5a8ab629f87f2161d2"
  }
}